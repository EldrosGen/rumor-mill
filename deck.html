<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rumourmill — Draw a Rumor</title>
  <style>
    :root{
      --bg1:#070a12;
      --bg2:#10182a;

      --ring: rgba(255,255,255,.16);
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --shadow: rgba(0,0,0,.55);

      --card: rgba(252, 250, 245, .98);
      --ink: #15161a;
      --muted: rgba(21,22,26,.62);

      --accent: rgba(140,90,255,.70);
      --accent2: rgba(80,200,140,.65);
      --accent3: rgba(255,170,60,.65);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:#fff;
      background:
        radial-gradient(1100px 780px at 18% 10%, rgba(60,120,255,.16), transparent 58%),
        radial-gradient(1000px 700px at 78% 20%, rgba(190,90,255,.12), transparent 55%),
        radial-gradient(900px 640px at 50% 92%, rgba(80,200,140,.10), transparent 56%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px;
    }

    .wrap{ width:min(1040px, 100%); }

    .top{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:12px;
      margin-bottom:14px;
    }

    .brand{ display:flex; flex-direction:column; gap:4px; }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      opacity:.94;
    }
    .brand .sub{ font-size:12px; opacity:.72; }

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }

    button{
      border:1px solid var(--ring);
      border-radius: 12px;
      padding: 10px 14px;
      background: var(--glass);
      color:#fff;
      cursor:pointer;
      box-shadow: 0 14px 40px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform .06s ease, background .12s ease;
    }
    button:hover{ background: var(--glass2); }
    button:active{ transform: translateY(1px); }

    .toggle{
      display:flex; align-items:center; gap:8px;
      font-size:13px; opacity:.92;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--ring);
      background: rgba(255,255,255,.06);
      box-shadow: 0 14px 40px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select:none;
    }
    .toggle input{ transform: translateY(1px); }

    .grid{
      display:grid;
      grid-template-columns: 1.45fr .55fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* === Card === */
    .card{
      background: linear-gradient(180deg, rgba(252,250,245,.99), rgba(246,244,238,.99));
      color: var(--ink);
      border-radius: 20px;
      padding: 16px 16px 14px;
      box-shadow: 0 28px 90px rgba(0,0,0,.62);
      border: 2px solid rgba(0,0,0,.10);
      overflow:hidden;
      position:relative;
      min-height: 280px;
    }

    /* subtle “paper grain” effect */
    .card::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 25% 18%, rgba(140,90,255,.10), transparent 52%),
        radial-gradient(circle at 76% 22%, rgba(80,200,140,.08), transparent 52%),
        radial-gradient(circle at 52% 82%, rgba(255,170,60,.06), transparent 52%),
        repeating-linear-gradient(0deg, rgba(0,0,0,.015), rgba(0,0,0,.015) 1px, transparent 1px, transparent 5px);
      pointer-events:none;
      opacity:.85;
      mix-blend-mode:multiply;
    }

    .cardInner{ position:relative; z-index:1; }

    .bannerRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }

    .banner{
      display:inline-flex;
      align-items:center;
      gap:10px;
      font-weight: 900;
      letter-spacing: .22em;
      font-size: 11px;
      text-transform: uppercase;
      color: rgba(21,22,26,.84);
    }

    .bannerDot{
      width:10px; height:10px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 5px rgba(140,90,255,.10);
    }

    .pill{
      font-size: 12px;
      padding: 5px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.05);
      border: 1px solid rgba(0,0,0,.12);
      white-space:nowrap;
      color: rgba(21,22,26,.78);
    }

    .title{
      font-size: 26px;
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1.1;
      margin: 4px 0 10px 0;
    }

    .body{
      font-size: 16px;
      line-height: 1.55;
      color: rgba(21,22,26,.88);
      white-space: pre-wrap;
    }

    .cardFooter{
      margin-top: 14px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size: 12px;
      color: var(--muted);
      border-top: 1px dashed rgba(0,0,0,.18);
      padding-top: 10px;
    }

    /* === Side Panel === */
    .panel{
      border:1px solid var(--ring);
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 14px 40px var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .panel h2{
      margin:0 0 10px 0;
      font-size: 13px;
      letter-spacing:.3px;
      text-transform: uppercase;
      opacity:.85;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }

    select, input[type="text"]{
      border:1px solid var(--ring);
      background: rgba(255,255,255,.08);
      color:#fff;
      border-radius: 12px;
      padding: 10px 12px;
      outline:none;
      width: 100%;
    }
    select option{ color:#111; }

    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      font-size: 12px;
      opacity:.88;
      margin-top: 10px;
    }
    .meta span{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--ring);
      background: rgba(255,255,255,.06);
    }

    ul.history{
      list-style:none;
      margin: 10px 0 0 0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:8px;
      max-height: 320px;
      overflow:auto;
    }
    ul.history li{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .hTitle{ font-weight: 900; font-size: 13px; margin-bottom: 3px; }
    .hSub{ font-size: 12px; opacity:.75; }

    .hint{
      font-size: 12px;
      opacity:.70;
      margin-top: 10px;
    }

    .pop{ animation: pop .16s ease-out; }
    @keyframes pop{ from{ transform: scale(.988); } to{ transform: scale(1); } }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1>Rumourmill</h1>
        <div class="sub">Tap <b>Draw</b> to pull a rumor. (Share this page with your players.)</div>
      </div>
      <div class="controls">
        <button id="drawBtn">Draw</button>
        <button id="copyBtn" title="Copy the current rumor to clipboard">Copy</button>
        <button id="resetBtn">Reset</button>
        <label class="toggle"><input id="noRepeats" type="checkbox" checked> No repeats</label>
      </div>
    </div>

    <div class="grid">
      <!-- Main Card -->
      <div id="card" class="card">
        <div class="cardInner">
          <div class="bannerRow">
            <div class="banner">
              <span class="bannerDot" aria-hidden="true"></span>
              <span>RUMOR</span>
            </div>
            <div id="tag" class="pill">All</div>
          </div>

          <div id="title" class="title">Ready.</div>
          <div id="body" class="body">Press <b>Draw</b> to pull a rumor from the pool.</div>

          <div class="cardFooter">
            <div>Remaining: <span id="remaining">—</span></div>
            <div>Filter: <span id="activeFilter">All</span></div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="panel">
        <h2>Filters</h2>

        <div class="row" style="margin-bottom:10px;">
          <div style="width:100%;">
            <div style="font-size:12px;opacity:.78;margin-bottom:6px;">Category</div>
            <select id="category"></select>
          </div>
        </div>

        <div class="row" style="margin-bottom:6px;">
          <div style="width:100%;">
            <div style="font-size:12px;opacity:.78;margin-bottom:6px;">Search (optional)</div>
            <input id="search" type="text" placeholder="e.g. Obsidion, goblin, mine..." />
          </div>
        </div>

        <div class="meta">
          <span id="totalMeta">Eligible: —</span>
          <span id="modeMeta">Mode: —</span>
        </div>

        <h2 style="margin-top:14px;">History</h2>
        <ul id="history" class="history"></ul>

        <div class="hint">
          To add more rumors, edit the <b>DATA</b> list in this file and commit.
        </div>
      </div>
    </div>
  </div>

<script>
  // =========================
  // 1) EDIT YOUR RUMORS HERE
  // =========================
  // Keep "id" unique.
  const DATA = [
    {
      id: "rumor_01_chainledger",
      title: "The Quartermaster’s Double Ledger",
      category: "Rebel Camp",
      body: "Otis the Quartermaster is convinced supplies are vanishing—ammo, dried meat, and chroma caps. He swears the crates arrive full, but the numbers keep slipping like someone is counting twice and carrying nothing."
    },
    {
      id: "rumor_02_redthreads",
      title: "Red Thread on the Scout Map",
      category: "Rebel Camp",
      body: "Mara “Hollow-Eye” Vex has patrol routes pinned up with red thread. She says the Ember Guard is moving like they’re drawing a symbol across the forest—not searching, not chasing—marking."
    },
    {
      id: "rumor_03_singingore",
      title: "The Ore That Sings Back",
      category: "Rebel Camp",
      body: "Garrik the smith claims a chunk of chroma ore rang like a bell when struck—then went ice-cold and crumbled to glittering dust. He won’t hit chroma bare-handed anymore."
    },
    {
      id: "rumor_04_healingscar",
      title: "The Geometric Scar",
      category: "Rebel Camp",
      body: "Silra the medic treated a crushed hand and it healed… strangely. The skin closed with a faint, neat geometric pattern, like lines in a blueprint. The patient says their fingers ‘tingle’ near chroma."
    },
    {
      id: "rumor_05_embertithe",
      title: "The Ember Guard’s New ‘Tithe’",
      category: "Dothmire",
      body: "The mines don’t call it a quota anymore. The Ember Guard calls it a ‘chroma tithe.’ If a family can’t pay in ore, they pay in people—someone is always ‘reassigned’."
    },
    {
      id: "rumor_06_minevanish",
      title: "Missing Between Two Turns",
      category: "Dothmire",
      body: "Miners whisper there’s a stretch in the tunnels where people disappear between two bends. No screams, no scuffle—just a dropped lantern and a faint smear of gray dust like ash."
    },
    {
      id: "rumor_07_blackpine",
      title: "The Black Pine Watch",
      category: "West Forest",
      body: "Scouts talk about a watchtower in the forest that wasn’t there a month ago—blackened wood, lantern light at night, and no tracks in the mud around it. As if it appeared already finished."
    },
    {
      id: "rumor_08_othmire_breathing",
      title: "Othmire’s Ruins Are ‘Breathing’",
      category: "Othmire",
      body: "Near Othmire, the old ruins vent warm air in slow pulses, like something sleeping under stone. On cold mornings, you can see the ‘breath’ from a distance like a ghost exhaling."
    },
    {
      id: "rumor_09_rustborne_treeline",
      title: "A Rustborne Watched the Camp",
      category: "Rebel Camp",
      body: "A guard swears they saw a Rustborne automata at the treeline. It didn’t attack. It just stood there, head tilted, as if listening, then turned and walked away into the dark."
    },
    {
      id: "rumor_10_white_mask_hunters",
      title: "Mask-Hunters Asking Questions",
      category: "Roads",
      body: "Travelers report strangers in clean cloaks asking about a spellcaster wearing a tarnished white mask. They pay for answers, but their smiles look practiced—like a ritual."
    },
    {
      id: "rumor_11_padlocked_tent",
      title: "The Tent Otis Won’t Explain",
      category: "Rebel Camp",
      body: "There’s a small tent behind the supply stacks with too many padlocks. Kids swear they heard tapping from inside—metal on wood, slow and patient—like something counting time."
    },
    {
      id: "rumor_12_goblin_messengers",
      title: "Goblins Carry Messages Now",
      category: "West Forest",
      body: "Someone has goblins running a message route through the western woods. Not raiders—messengers. Quick, disciplined, wearing scraps stamped with symbols like uniforms."
    },
    {
      id: "rumor_13_firepit_echo",
      title: "The Fire That Repeats Words",
      category: "Rebel Camp",
      body: "Late at night, if you stare into the central fire long enough, you can hear faint echoes—snatches of conversations from earlier in the day. Some swear the fire ‘learns’ secrets."
    },
    {
      id: "rumor_14_chroma_storm",
      title: "The Silent Lightning Storm",
      category: "Karnathi Mountains",
      body: "A green-violet storm rolled over the mountains—lightning that struck with no thunder. Afterward, compasses spun, and the ground held glassy footprints like heat-melted stone."
    },

    /* --- Obsidion political distress (NEW / REPLACEMENTS) --- */
    {
      id: "rumor_15_obsidion_king_ill",
      title: "The King Isn’t Seen Anymore",
      category: "Obsidion",
      body: "Merchants claim the Obsidion King hasn’t appeared on the high balcony in weeks. Official notices insist he’s ‘in prayer and strategy,’ but the city’s tone feels… leaderless."
    },
    {
      id: "rumor_16_obsidion_court_cuts",
      title: "The Court Is Purging Itself",
      category: "Obsidion",
      body: "Aetherian officers are being reassigned overnight and noble aides vanish from the record books. People whisper the palace is cutting out anyone who asks the wrong question—before the question spreads."
    },
    {
      id: "rumor_17_obsidion_coin_thins",
      title: "Obsidion Coin Feels ‘Light’",
      category: "Obsidion",
      body: "Trek traders say fresh-minted Obsidion coins feel slightly lighter than they should. Some refuse them. Others say it’s just paranoia—until you hear how quickly prices rose this month."
    },
    {
      id: "rumor_18_obsidion_river_blockade",
      title: "The River Is Being ‘Checked’",
      category: "Trek",
      body: "The river route between Trek and Obsidion is slowing. New checkpoints demand paperwork for everything—food, tools, even blankets—like Obsidion is bracing for unrest or hoarding supplies."
    },
    {
      id: "rumor_19_obsidion_food_lines",
      title: "Food Lines Under Guard",
      category: "Obsidion",
      body: "A traveler swears there are bread lines guarded by soldiers in Obsidion’s lower streets. People keep their heads down and speak in codes, because complaining gets you ‘reassigned.’"
    },
    {
      id: "rumor_20_obsidion_succession",
      title: "Succession Whispers in High Houses",
      category: "Obsidion",
      body: "Nobles are quietly marrying off heirs and securing alliances, fast. The rumor is simple: someone expects a change at the top—whether by sickness, coup, or ‘necessary’ replacement."
    }
  ];

  // =========================
  // 2) APP STATE
  // =========================
  const STORAGE_KEY = "rumourmill_state_v2";

  let state = {
    remainingIds: [],
    historyIds: [],
    category: "All",
    search: ""
  };

  const el = {
    card: document.getElementById("card"),
    title: document.getElementById("title"),
    tag: document.getElementById("tag"),
    body: document.getElementById("body"),
    remaining: document.getElementById("remaining"),
    activeFilter: document.getElementById("activeFilter"),
    drawBtn: document.getElementById("drawBtn"),
    resetBtn: document.getElementById("resetBtn"),
    copyBtn: document.getElementById("copyBtn"),
    noRepeats: document.getElementById("noRepeats"),
    category: document.getElementById("category"),
    search: document.getElementById("search"),
    history: document.getElementById("history"),
    totalMeta: document.getElementById("totalMeta"),
    modeMeta: document.getElementById("modeMeta"),
  };

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function getById(id){ return DATA.find(x => x.id === id); }

  function categories(){
    const set = new Set(DATA.map(x => x.category).filter(Boolean));
    return ["All", ...Array.from(set).sort((a,b)=>a.localeCompare(b))];
  }

  function filteredData(){
    const cat = state.category;
    const q = (state.search || "").trim().toLowerCase();

    return DATA.filter(item => {
      if (cat !== "All" && item.category !== cat) return false;
      if (!q) return true;
      const hay = `${item.title} ${item.category} ${item.body}`.toLowerCase();
      return hay.includes(q);
    });
  }

  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      state,
      noRepeats: el.noRepeats.checked
    }));
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      const parsed = JSON.parse(raw);
      if(parsed?.state) state = parsed.state;
      if(typeof parsed?.noRepeats === "boolean") el.noRepeats.checked = parsed.noRepeats;
      return true;
    } catch {
      return false;
    }
  }

  function reshuffleRemainingFromCurrentFilter(){
    const eligible = filteredData().map(x => x.id);
    state.remainingIds = [...eligible];
  }

  function initUI(){
    el.category.innerHTML = "";
    for(const c of categories()){
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      el.category.appendChild(opt);
    }
    el.category.value = state.category || "All";
    el.search.value = state.search || "";
  }

  function updateMeta(){
    const eligibleCount = filteredData().length;
    el.totalMeta.textContent = `Eligible: ${eligibleCount}`;
    el.modeMeta.textContent = `Mode: ${el.noRepeats.checked ? "No repeats" : "Repeats OK"}`;

    let filterLabel = (state.category === "All") ? "All" : state.category;
    if ((state.search || "").trim()) filterLabel += " + Search";
    el.activeFilter.textContent = filterLabel;

    if (el.noRepeats.checked){
      const eligibleSet = new Set(filteredData().map(x=>x.id));
      const remainingEligible = state.remainingIds.filter(id => eligibleSet.has(id));
      el.remaining.textContent = `${remainingEligible.length} / ${eligibleSet.size}`;
    } else {
      el.remaining.textContent = "∞";
    }
  }

  function renderHistory(){
    el.history.innerHTML = "";
    const ids = state.historyIds.slice(0, 12);
    for(const id of ids){
      const item = getById(id);
      if(!item) continue;
      const li = document.createElement("li");
      li.innerHTML = `
        <div class="hTitle">${escapeHtml(item.title)}</div>
        <div class="hSub">${escapeHtml(item.category || "—")}</div>
      `;
      el.history.appendChild(li);
    }
  }

  function renderCard(item){
    el.card.classList.remove("pop");
    void el.card.offsetWidth;
    el.card.classList.add("pop");

    el.title.textContent = item.title;
    el.tag.textContent = item.category || "Rumor";
    el.body.textContent = item.body;
  }

  function pushHistory(id){
    state.historyIds.unshift(id);
    state.historyIds = Array.from(new Set(state.historyIds)).slice(0, 50);
  }

  function draw(){
    const eligible = filteredData();

    if(eligible.length === 0){
      renderCard({
        title: "No matches",
        category: "Filter",
        body: "Your filter/search has no eligible rumors. Change the category or clear the search box."
      });
      return;
    }

    if(!el.noRepeats.checked){
      const pick = eligible[Math.floor(Math.random() * eligible.length)];
      pushHistory(pick.id);
      renderCard(pick);
      save();
      updateMeta();
      renderHistory();
      return;
    }

    const eligibleSet = new Set(eligible.map(x => x.id));
    const remainingEligible = state.remainingIds.filter(id => eligibleSet.has(id));

    if(remainingEligible.length === 0){
      renderCard({
        title: "Pool empty",
        category: "Reset",
        body: "You’ve drawn everything in this filtered pool. Hit Reset to reshuffle (or change your filter)."
      });
      return;
    }

    const idx = Math.floor(Math.random() * remainingEligible.length);
    const pickedId = remainingEligible[idx];

    state.remainingIds = state.remainingIds.filter(id => id !== pickedId);

    const picked = getById(pickedId);
    if(picked){
      pushHistory(picked.id);
      renderCard(picked);
    }

    save();
    updateMeta();
    renderHistory();
  }

  function reset(){
    reshuffleRemainingFromCurrentFilter();
    state.historyIds = [];
    renderHistory();
    updateMeta();
    save();
    renderCard({
      title: "Reset complete",
      category: "Rumor",
      body: "The rumor pool has been reshuffled. Press Draw."
    });
  }

  async function copyCurrent(){
    const text = `${el.title.textContent}\n\n${el.body.textContent}`;
    try{
      await navigator.clipboard.writeText(text);
      el.copyBtn.textContent = "Copied!";
      setTimeout(()=> el.copyBtn.textContent = "Copy", 900);
    } catch {
      alert("Couldn't copy automatically. Select the text on the page and copy manually.");
    }
  }

  // Wire up events
  el.drawBtn.addEventListener("click", draw);
  el.resetBtn.addEventListener("click", reset);
  el.copyBtn.addEventListener("click", copyCurrent);

  el.category.addEventListener("change", () => {
    state.category = el.category.value;
    if(el.noRepeats.checked) reshuffleRemainingFromCurrentFilter();
    updateMeta();
    save();
  });

  el.search.addEventListener("input", () => {
    state.search = el.search.value;
    if(el.noRepeats.checked) reshuffleRemainingFromCurrentFilter();
    updateMeta();
    save();
  });

  el.noRepeats.addEventListener("change", () => {
    if(el.noRepeats.checked) reshuffleRemainingFromCurrentFilter();
    updateMeta();
    save();
  });

  // Init
  load();
  initUI();

  if(!Array.isArray(state.remainingIds) || state.remainingIds.length === 0){
    reshuffleRemainingFromCurrentFilter();
  }

  updateMeta();
  renderHistory();

  renderCard({
    title: "Ready.",
    category: "Rumor",
    body: "Press Draw to pull a rumor from the pool."
  });

  save();
</script>
</body>
</html>
